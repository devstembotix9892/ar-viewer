

  <!-- Controls Wrapper -->

  <div id="controls-wrapper" class="glass-controls new-controls-layout">
    <div class="side-zoom-btn">
      <button id="btn-zoom-in" class="glass-btn round-btn zoom-side-btn" title="Zoom In">Ôºã</button>
    </div>
    <div id="move-controls" class="move-controls">
      <button id="btn-up" class="glass-btn round-btn">‚ñ≤</button>
      <div class="move-row">
        <button id="btn-left" class="glass-btn round-btn">‚óÄ</button>
        <button id="btn-down" class="glass-btn round-btn">‚ñº</button>
        <button id="btn-right" class="glass-btn round-btn">‚ñ∂</button>
      </div>
    </div>
    <div class="side-zoom-btn">
      <button id="btn-zoom-out" class="glass-btn round-btn zoom-side-btn" title="Zoom Out">Ôºç</button>
    </div>
  </div>





<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls@1.3.2/dist/aframe-orbit-controls.min.js"></script>

  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      /* background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%); */
      min-height: 100vh;
    }
    #instructions {
      position: absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 18px;
      background: rgba(0, 0, 0, 0.6);
      padding: 16px 28px;
      z-index: 10;
      border-radius: 14px;
      max-width: 90%;
      box-shadow: 0 4px 24px #0004;
      letter-spacing: 0.02em;
      backdrop-filter: blur(4px);
      border: 1.5px solid rgba(255,255,255,0.12);
      animation: fadeInDown 1s cubic-bezier(.23,1.01,.32,1) 0.2s both;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translate(-50%, -30px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
    .glass-controls {
      position: fixed;
      bottom: 36px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0px;
      background: rgba(255,255,255,0.10);
      border-radius: 22px;
      box-shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
      padding: 9px 5px;
      backdrop-filter: blur(10px);
      border: 1.5px solid rgba(255,255,255,0.18);
      animation: controlsPopIn 1.2s cubic-bezier(.23,1.01,.32,1) 0.5s both;
    }
    .new-controls-layout .move-controls {
      margin: 0 8px;
    }
    .side-zoom-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .zoom-side-btn {
      font-size: 28px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #007bff 0%, #00c6ff 100%);
      color: #fff;
      box-shadow: 0 2px 8px #007bff22;
      min-width: 0;
      margin: 0;
      padding: 0;
    }
    .zoom-side-btn:hover, .zoom-side-btn:focus {
      background: linear-gradient(135deg, #00c6ff 0%, #007bff 100%);
      color: #fff;
      box-shadow: 0 6px 18px #00c6ff44;
      transform: scale(1.08);
    }
    @keyframes controlsPopIn {
      from { opacity: 0; transform: translate(-50%, 40px) scale(0.95); }
      to { opacity: 1; transform: translate(-50%, 0) scale(1); }
    }
    .move-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .move-row {
      display: flex;
      flex-direction: row;
      gap: 12px;
    }
    .glass-btn {
      font-size: 20px;
      border: none;
      border-radius: 12px;
      background: rgba(255,255,255,0.18);
      color: #fff;
      box-shadow: 0 2px 8px #0002;
      padding: 0 18px;
      height: 44px;
      min-width: 110px;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
      font-weight: 500;
      outline: none;
      letter-spacing: 0.01em;
      margin: 0 0 0 0;
    }
    .glass-btn:hover, .glass-btn:focus {
      background: rgba(0,123,255,0.22);
      color: #fff;
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 6px 18px #007bff44;
    }
    .zoom-btn {
      min-width: 120px;
      height: 42px;
      font-size: 17px;
      border-radius: 10px;
      margin-bottom: 2px;
      margin-top: 2px;
      background: linear-gradient(90deg, #007bff 0%, #00c6ff 100%);
      color: #fff;
      box-shadow: 0 2px 8px #007bff22;
    }
    .zoom-btn:hover, .zoom-btn:focus {
      background: linear-gradient(90deg, #00c6ff 0%, #007bff 100%);
      color: #fff;
      box-shadow: 0 6px 18px #00c6ff44;
    }
    .round-btn {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      font-size: 26px;
      background: rgba(34,34,34,0.85);
      color: #fff;
      box-shadow: 0 2px 8px #0003;
      padding: 0;
      min-width: 0;
      margin: 0;
    }
    .round-btn:hover, .round-btn:focus {
      background: linear-gradient(135deg, #007bff 0%, #00c6ff 100%);
      color: #fff;
      box-shadow: 0 6px 18px #007bff44;
      transform: scale(1.08);
    }
    @media (max-width: 600px) {
      .glass-controls {
        padding: 10px 8px;
        gap: 8px;
        flex-direction: row;
      }
      .move-row {
        gap: 6px;
      }
      .glass-btn, .zoom-btn {
        font-size: 15px;
        min-width: 80px;
        height: 36px;
      }
      .round-btn {
        width: 38px;
        height: 38px;
        font-size: 18px;
      }
      #instructions {
        font-size: 15px;
        padding: 10px 8px;
      }
    }
  </style>
</head>
<body>
  <div id="instructions">‚è≥ Loading AR Viewer...</div>

  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-assets id="assets"></a-assets>

    <!-- <a-marker preset="hiro" id="hiro-marker"> -->
      <a-marker type="pattern" url="./Blockzie-Pattern-img.patt" id="custom-marker">

      <!-- <a-entity id="model" position="0 0 0" scale="1 1 1" rotation="0 0 0" visible="false"></a-entity> -->
      <!-- <a-entity id="model" 
          position="0 0.5 0" 
          scale="0.5 0.5 0.5" 
          rotation="-90 0 0" 
          visible="false"></a-entity> -->
<a-entity id="model"
          position="0 0.5 0"
          
          scale="0.5 0.5 0.5"
          rotation="-90 0 0"
           visible="false">
</a-entity>
 <!-- animation="property: rotation; to: -90 360 0; loop: true; dur: 8000" -->
        
    </a-marker>

    <!-- <a-entity camera></a-entity> -->
     
    <a-light type="ambient" color="#ffffff" intensity="1"></a-light>
    <a-light type="directional" position="1 1 0.5" intensity="1"></a-light>
  </a-scene>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('üìÑ DOM fully loaded, initializing AR scene...');
      
      const modelUrl = new URLSearchParams(window.location.search).get('url');
      const modelEntity = document.getElementById('model');
      // const marker = document.getElementById('hiro-marker');
      const marker = document.getElementById('custom-marker');

      const instructions = document.getElementById('instructions');

      // Movement controls
      const btnUp = document.getElementById('btn-up');
      const btnDown = document.getElementById('btn-down');
      const btnLeft = document.getElementById('btn-left');
      const btnRight = document.getElementById('btn-right');

      // Zoom controls
      const btnZoomIn = document.getElementById('btn-zoom-in');
      const btnZoomOut = document.getElementById('btn-zoom-out');

      // Move step size
      const MOVE_STEP = 0.1;

      // Zoom step size (Z axis)
      const ZOOM_STEP = 0.1;

      function moveModel(dx, dy) {
        if (!modelEntity) return;
        const pos = modelEntity.getAttribute('position');
        // Y is up in A-Frame, X is left/right
        modelEntity.setAttribute('position', {
          x: pos.x + dx,
          y: pos.y + dy,
          z: pos.z
        });
      }

      function zoomModel(dz) {
        if (!modelEntity) return;
        const pos = modelEntity.getAttribute('position');
        modelEntity.setAttribute('position', {
          x: pos.x,
          y: pos.y,
          z: pos.z + dz
        });
      }

      btnUp.addEventListener('click', () => moveModel(0, MOVE_STEP));
      btnDown.addEventListener('click', () => moveModel(0, -MOVE_STEP));
      btnLeft.addEventListener('click', () => moveModel(-MOVE_STEP, 0));
      btnRight.addEventListener('click', () => moveModel(MOVE_STEP, 0));

      btnZoomIn.addEventListener('click', () => zoomModel(-ZOOM_STEP)); // Move model closer
      btnZoomOut.addEventListener('click', () => zoomModel(ZOOM_STEP)); // Move model farther

      // Touch gesture support for model rotation (orbit) and zoom
      let lastTouch = null;
      let lastDistance = null;
      let lastRotation = null;
      const scene = document.querySelector('a-scene');

      function getTouchPos(touch) {
        return { x: touch.clientX, y: touch.clientY };
      }

      let lastAngle = null;
      scene.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) {
          lastTouch = getTouchPos(e.touches[0]);
          lastRotation = modelEntity.getAttribute('rotation');
        } else if (e.touches.length === 2) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          lastDistance = Math.sqrt(dx * dx + dy * dy);
          lastAngle = Math.atan2(dy, dx);
          lastRotation = modelEntity.getAttribute('rotation');
        }
      });

      scene.addEventListener('touchmove', (e) => {
        if (e.touches.length === 1 && lastTouch && lastRotation) {
          const newTouch = getTouchPos(e.touches[0]);
          const dx = newTouch.x - lastTouch.x;
          const dy = newTouch.y - lastTouch.y;
          // Horizontal drag: rotate X (x round)
          // Vertical drag: rotate Y (left/right)
          modelEntity.setAttribute('rotation', {
            x: lastRotation.x + dx * 0.3,
            y: lastRotation.y + dy * 0.3,
            z: lastRotation.z
          });
        } else if (e.touches.length === 2 && lastDistance !== null && lastAngle !== null && lastRotation) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          const newDistance = Math.sqrt(dx * dx + dy * dy);
          const dz = (lastDistance - newDistance) / 200; // scale factor for zoom
          zoomModel(dz);
          // Z rotation (two-finger rotate)
          const newAngle = Math.atan2(dy, dx);
          const dAngle = (newAngle - lastAngle) * (180 / Math.PI); // radians to degrees
          modelEntity.setAttribute('rotation', {
            x: lastRotation.x,
            y: lastRotation.y,
            z: lastRotation.z + dAngle
          });
        }
      });

      scene.addEventListener('touchend', (e) => {
        if (e.touches.length === 0) {
          lastTouch = null;
          lastDistance = null;
          lastRotation = null;
          lastAngle = null;
        }
      });

      if (!modelUrl) {
        console.warn('‚ùó No model URL provided in the query string');
        instructions.textContent = '‚ö†Ô∏è No model URL provided. Add ?url=yourModel.glb to the link.';
        instructions.style.background = 'rgba(255, 0, 0, 0.6)';
        return;
      }

      console.log('üåê Loading Model URL:', modelUrl);
      instructions.textContent = '‚è≥ Loading 3D model...';

      // Load the model
      modelEntity.setAttribute('gltf-model', modelUrl);

      // let billboardEnabled = true;
      // let billboardFrameHandler = null;
      // const toggleBillboardBtn = document.getElementById('toggle-billboard');

      modelEntity.addEventListener('model-loaded', () => {
        console.log('‚úÖ Model successfully loaded in AR');
        modelEntity.setAttribute('visible', 'true');
        instructions.textContent = 'üì∏ Point your camera at the Blockzie marker';

      });

   
      modelEntity.addEventListener('model-error', (e) => {
        console.error('‚ùå Error loading model:', e.detail);
        instructions.textContent = '‚ö†Ô∏è Failed to load model.';
        instructions.style.background = 'rgba(255, 0, 0, 0.6)';
      });

      marker.addEventListener('markerFound', () => {
        console.log('üìç Marker found');
      });

      marker.addEventListener('markerLost', () => {
        console.log('üö´ Marker lost');
      });
    });
  </script>
</body>
</html>